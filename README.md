# springboot3 下体验 springnative
1. 默认native打包，默认使用 `glibc`
```
./mvnw -Pnative native:compile
```
2. 尽可能的 `static` ,只支持 `glibc`
```
./mvnw -Pnative native:compile -DbuildArgs=-H:+StaticExecutableWithDynamicLibC
```
3. 编译为完全 `static`，仅支持 `musl` 且必须是 `static`
```
./mvnw -Pnative native:compile -DbuildArgs=--static,--libc=musl
```
~~报错~~ [已解决](https://github.com/fishandsheep/springnative/issues/1)
```
[INFO] Executing: /home/gitpod/.sdkman/candidates/java/current/bin/native-image -cp /workspace/springnative/target/classes:/workspace/m2-repository/org/slf4j/jul-to-slf4j/2.0.4/jul-to-slf4j-2.0.4.jar:/workspace/m2-repository/org/springframework/spring-web/6.0.2/spring-web-6.0.2.jar:/workspace/m2-repository/ch/qos/logback/logback-core/1.4.5/logback-core-1.4.5.jar:/workspace/m2-repository/jakarta/annotation/jakarta.annotation-api/2.1.1/jakarta.annotation-api-2.1.1.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-annotations/2.14.1/jackson-annotations-2.14.1.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-json/3.0.0/spring-boot-starter-json-3.0.0.jar:/workspace/m2-repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.14.1/jackson-module-parameter-names-2.14.1.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-websocket/10.1.1/tomcat-embed-websocket-10.1.1.jar:/workspace/m2-repository/org/springframework/spring-core/6.0.2/spring-core-6.0.2.jar:/workspace/m2-repository/ch/qos/logback/logback-classic/1.4.5/logback-classic-1.4.5.jar:/workspace/m2-repository/org/springframework/spring-jcl/6.0.2/spring-jcl-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-web/3.0.0/spring-boot-starter-web-3.0.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-autoconfigure/3.0.0/spring-boot-autoconfigure-3.0.0.jar:/workspace/m2-repository/org/springframework/spring-beans/6.0.2/spring-beans-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-tomcat/3.0.0/spring-boot-starter-tomcat-3.0.0.jar:/workspace/m2-repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.14.1/jackson-datatype-jsr310-2.14.1.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-el/10.1.1/tomcat-embed-el-10.1.1.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-core/2.14.1/jackson-core-2.14.1.jar:/workspace/m2-repository/org/apache/logging/log4j/log4j-api/2.19.0/log4j-api-2.19.0.jar:/workspace/m2-repository/org/springframework/spring-expression/6.0.2/spring-expression-6.0.2.jar:/workspace/m2-repository/org/springframework/spring-webmvc/6.0.2/spring-webmvc-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot/3.0.0/spring-boot-3.0.0.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-core/10.1.1/tomcat-embed-core-10.1.1.jar:/workspace/m2-repository/org/springframework/spring-aop/6.0.2/spring-aop-6.0.2.jar:/workspace/m2-repository/org/apache/logging/log4j/log4j-to-slf4j/2.19.0/log4j-to-slf4j-2.19.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter/3.0.0/spring-boot-starter-3.0.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-logging/3.0.0/spring-boot-starter-logging-3.0.0.jar:/workspace/m2-repository/org/slf4j/slf4j-api/2.0.4/slf4j-api-2.0.4.jar:/workspace/m2-repository/org/springframework/spring-context/6.0.2/spring-context-6.0.2.jar:/workspace/m2-repository/io/micrometer/micrometer-observation/1.10.2/micrometer-observation-1.10.2.jar:/workspace/m2-repository/org/yaml/snakeyaml/1.33/snakeyaml-1.33.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-databind/2.14.1/jackson-databind-2.14.1.jar:/workspace/m2-repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.14.1/jackson-datatype-jdk8-2.14.1.jar:/workspace/m2-repository/io/micrometer/micrometer-commons/1.10.2/micrometer-commons-1.10.2.jar --no-fallback -H:Path=/workspace/springnative/target -H:Name=springnative -H:ConfigurationFileDirectories=/workspace/springnative/target/graalvm-reachability-metadata/ecd9533fa8f33e47f6796e68f3d671ffa0619978/ch.qos.logback/logback-classic/1.4.1,/workspace/springnative/target/graalvm-reachability-metadata/ecd9533fa8f33e47f6796e68f3d671ffa0619978/org.apache.tomcat.embed/tomcat-embed-core/10.0.20 --static --libc=musl
========================================================================================================================
GraalVM Native Image: Generating 'springnative' (static executable)...
========================================================================================================================
[1/7] Initializing...
                                                                                    (0.0s @ 0.26GB)
Error: Building images for org.graalvm.nativeimage.Platform$LINUX_AMD64 (target libc: musl) requires static JDK libraries.
Use most recent JDK from https://github.com/graalvm/labs-openjdk-*/releases
Missing libraries: java, nio, net, zip
(search path: /home/gitpod/.sdkman/candidates/java/22.3.r17-nik/lib/static/linux-amd64/musl)
Error: Use -H:+ReportExceptionStackTraces to print stacktrace of underlying exception
------------------------------------------------------------------------------------------------------------------------
                         0.4s (5.2% of total time) in 8 GCs | Peak RSS: 0.67GB | CPU load: 3.22
========================================================================================================================
Failed generating 'springnative' after 6.3s.
Error: Image build request failed with exit status 1
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  17.990 s
[INFO] Finished at: 2022-12-07T16:57:14Z
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.graalvm.buildtools:native-maven-plugin:0.9.18:compile (default-cli) on project springnative: Execution of /home/gitpod/.sdkman/candidates/java/current/bin/native-image -cp /workspace/springnative/target/classes:/workspace/m2-repository/org/slf4j/jul-to-slf4j/2.0.4/jul-to-slf4j-2.0.4.jar:/workspace/m2-repository/org/springframework/spring-web/6.0.2/spring-web-6.0.2.jar:/workspace/m2-repository/ch/qos/logback/logback-core/1.4.5/logback-core-1.4.5.jar:/workspace/m2-repository/jakarta/annotation/jakarta.annotation-api/2.1.1/jakarta.annotation-api-2.1.1.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-annotations/2.14.1/jackson-annotations-2.14.1.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-json/3.0.0/spring-boot-starter-json-3.0.0.jar:/workspace/m2-repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.14.1/jackson-module-parameter-names-2.14.1.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-websocket/10.1.1/tomcat-embed-websocket-10.1.1.jar:/workspace/m2-repository/org/springframework/spring-core/6.0.2/spring-core-6.0.2.jar:/workspace/m2-repository/ch/qos/logback/logback-classic/1.4.5/logback-classic-1.4.5.jar:/workspace/m2-repository/org/springframework/spring-jcl/6.0.2/spring-jcl-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-web/3.0.0/spring-boot-starter-web-3.0.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-autoconfigure/3.0.0/spring-boot-autoconfigure-3.0.0.jar:/workspace/m2-repository/org/springframework/spring-beans/6.0.2/spring-beans-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-tomcat/3.0.0/spring-boot-starter-tomcat-3.0.0.jar:/workspace/m2-repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.14.1/jackson-datatype-jsr310-2.14.1.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-el/10.1.1/tomcat-embed-el-10.1.1.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-core/2.14.1/jackson-core-2.14.1.jar:/workspace/m2-repository/org/apache/logging/log4j/log4j-api/2.19.0/log4j-api-2.19.0.jar:/workspace/m2-repository/org/springframework/spring-expression/6.0.2/spring-expression-6.0.2.jar:/workspace/m2-repository/org/springframework/spring-webmvc/6.0.2/spring-webmvc-6.0.2.jar:/workspace/m2-repository/org/springframework/boot/spring-boot/3.0.0/spring-boot-3.0.0.jar:/workspace/m2-repository/org/apache/tomcat/embed/tomcat-embed-core/10.1.1/tomcat-embed-core-10.1.1.jar:/workspace/m2-repository/org/springframework/spring-aop/6.0.2/spring-aop-6.0.2.jar:/workspace/m2-repository/org/apache/logging/log4j/log4j-to-slf4j/2.19.0/log4j-to-slf4j-2.19.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter/3.0.0/spring-boot-starter-3.0.0.jar:/workspace/m2-repository/org/springframework/boot/spring-boot-starter-logging/3.0.0/spring-boot-starter-logging-3.0.0.jar:/workspace/m2-repository/org/slf4j/slf4j-api/2.0.4/slf4j-api-2.0.4.jar:/workspace/m2-repository/org/springframework/spring-context/6.0.2/spring-context-6.0.2.jar:/workspace/m2-repository/io/micrometer/micrometer-observation/1.10.2/micrometer-observation-1.10.2.jar:/workspace/m2-repository/org/yaml/snakeyaml/1.33/snakeyaml-1.33.jar:/workspace/m2-repository/com/fasterxml/jackson/core/jackson-databind/2.14.1/jackson-databind-2.14.1.jar:/workspace/m2-repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.14.1/jackson-datatype-jdk8-2.14.1.jar:/workspace/m2-repository/io/micrometer/micrometer-commons/1.10.2/micrometer-commons-1.10.2.jar --no-fallback -H:Path=/workspace/springnative/target -H:Name=springnative -H:ConfigurationFileDirectories=/workspace/springnative/target/graalvm-reachability-metadata/ecd9533fa8f33e47f6796e68f3d671ffa0619978/ch.qos.logback/logback-classic/1.4.1,/workspace/springnative/target/graalvm-reachability-metadata/ecd9533fa8f33e47f6796e68f3d671ffa0619978/org.apache.tomcat.embed/tomcat-embed-core/10.0.20 --static --libc=musl returned non-zero result -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException
```
